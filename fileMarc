The code changes from Marc
